# AGENTS.md（v0.1）— AI コーディングエージェント向け指示書

AGENTS.md は「AI エージェント向け README」として、プロジェクトの文脈と制約を伝えるためのファイル。

## 0. このリポジトリの最優先ゴール

年末年始の短期回収モデルに最適化された **六命占術×MBTI 診断（無料→¥980単発課金）** を最短でリリースする。

「正確さ」ではなく「回収効率」を最優先。  
要件定義書にない機能は実装しない。

## 1. 絶対に守る制約（破ると失敗）

- 画面は5つ固定：`/` `/start` `/result/free` `/pay` `/result/paid`
- 画面追加禁止
- 課金は Stripe Checkout 単発 ¥980 のみ
- プラン追加・割引・カウントダウン禁止
- サーバに個人情報を保存しない（A

## 2. 標準スタック（確定）

- Next.js（App Router）
- Tailwind CSS
- Vercel
- Stripe Checkout
- GA4（イベント計測）
- コンテンツ：Git 管理 JSON
- Supabase は将来拡張候補だが、現時点の必須ではない（保存要件が「保存しない」ため）。

## 3. 実装の骨格（必須要件）

### 3.1 ルーティング

- `app/page.tsx` → LP（CTA「無料で確認する」）
- `app/start/page.tsx` → 入力（生年月日 + MBTI 16択）
- `app/result/free/page.tsx` → 無料結果（順序固定 / CTA「回避方法を見る（¥980）」）
- `app/pay/page.tsx` → 決済開始（Checkout Session 作成→リダイレクト）
- `app/result/paid/page.tsx` → 有料結果（購入検証済みのみ表示）

### 3.2 六命占術算出（決定論・一貫性優先）

- 基準日：`1900-01-01`
- `rokumei_id = (days mod 12) + 1`
- `rokumei_name` は固定テーブル（初期：6種×±の金星人〜天王星人）

### 3.3 コンテンツ

- `content.json` もしくは `content/{rokumei_id}/{mbti}.json` のいずれかに固定
- Free / Paid で必要キーを必ず満たす
- 実行時生成禁止（運用は差し替え前提の編集）

### 3.4 決済（Stripe）

- Checkout セッションを作成し、Stripe hosted checkout に遷移
- 成功後、Webhook 検証で購入済みを確定
- `checkout.session.completed` を受けて「購入済みトークン」を発行する等の方式にする
- 有料結果は「購入済み」の検証が通らない限り表示しない

注意：個人情報を保持しない要件があるため、永続DBでのユーザー紐付けは行わない。  
セッション検証・短期トークン・署名 Cookie 等の最小構成で成立させる。

## 4. 計測（GA4）

必須イベント：

- `lp_view`
- `start_click`
- `input_submit`
- `free_result_view`
- `paywall_click`
- `checkout_start`
- `purchase_success`
- `paid_result_view`

## 5. 作業規約（Gemini CLI / Codex 向け）

### 5.1 自動実行禁止

- コマンドを勝手に実行しない
- コマンドは「例」として提示し、ユーザー確認を前提にする

### 5.2 破壊的操作禁止

- `rm -rf`、DB 初期化、環境変数の上書き、秘密情報のコミットは禁止
- 依存更新で大規模差分が出る変更は禁止（短期回収モデルのため）

### 5.3 変更の粒度

- 1 PR（または 1 コミット） = 1 意図
- 変更理由を短く明記（「回収効率のため」「5画面維持のため」など）

### 5.4 不明点の扱い

- 推測で埋めない。必要なら `{{TODO: 未確定}}` を残し、質問として提示する
- ただし本プロジェクトは要件が固定のため、新規仕様の提案は原則しない

## 6. テストと品質（最小）

- 重要導線（LP→入力→無料→決済→有料）の手動確認が最優先
- 表示崩れ（モバイル）と速度劣化を最優先で潰す

## 7. 生成物の優先順位

- 5画面の完成（導線が通る）
- 決済が成立する（Webhook 検証）
- JSON 差し替えで内容が変わる
- GA4 でイベントが取れる
